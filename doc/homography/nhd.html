<!doctype html>
<html>
 <head>
  <title>Construction of Homography Transformation in six simple steps</title>

<style>
.matrix {
    position: relative;
}
.matrix:before, .matrix:after {
    content: "";
    position: absolute;
    top: 0;
    border: 1px solid #000;
    width: 6px;
    height: 100%;
}
.matrix:before {
    left: -6px;
    border-right: 0px;
}
.matrix:after {
    right: -6px;
    border-left: 0px;
}
.matrix td {
    padding: 5px;
    text-align: center;
    color:black;
}

.left_fence
 {
    border-left: 1px solid #000;
 }

</style>
 </head>
 <body>
  <h1 align="center">Natural Construction of Homography Transformation</h1>
  <h2 align="center">Dejan Milosavljevic</h2>
  <h3 align="center">dmilos@gmail.com</h3>

 <dl>

 <dt>  <h3>TOC</h3></dt>
 <dd>
  <ul>
      <li>Description</li>
      <li>Nomenclature</li>
      <li>Problem</li>
      <li>Existing Solutions
        <ul>
            <li>TODO</li>
            <li>TODO</li>
            <li>h<sub>33</sub> = 1 </li>
        </ul>
      </li>

      <li>Bricks
        <ul>
            <li>Translate</li>
            <li>Linear</li>
            <li>Affine</li>
            <li>Simple Homography</li>
        </ul>
      </li>

      <li>Building
        <ul>
            <li>Ingredients</li>
            <li>Goal</li>
            <li>Elements</li>
            <li>Assembling</li>
        </ul>
      </li>
      <li>Assembling</li>
      <li>Miscellaneous</li>
  </ul>

 </dd>


  <dt><h3>Description</h3></dt>
   <dd> Computing the plane to plane homography without fancy thing such as inversion of big matrix or eugen vectors values.<br>
   In here it will be present method in step-by-step manner where every step has some geometric  meaning.

   </dd>
  <dt><h3>Nomenclature</h3></dt>
   <dd>
     <dl>
        <dt><h4>2D Euclid vector</h4></dt>
        <dd>
           Ordered pair of two real numbers.<br>
          <b>p</b> = ( x, y ) = [x,y] <sup>T</sup>; x,y &isin; &reals;
        </dd>
        <dt><h4>2D Homography vector</h4></dt>
        <dd>
                 Ordered triplet of three real numbers.<br>
        <b>p</b> = ( x, y, z ) = [x,y,z] <sup>T</sup>  x, y, z &isin; &reals;

        </dd>
        <dt><h4>2D Euclid matrix</h4></dt>
        <dd> 2 by 2 table of real number
            <table class="matrix" >
              <tr>   <td> m<sub>11</sub> </td> <td> m<sub>12</sub> </td>  </tr>
              <tr>   <td> m<sub>21</sub> </td> <td> m<sub>22</sub> </td>  </tr>
            </table>
        </dd>
        <dt><h4>2D Homography matrix</h4></dt>
        <dd>
            <table class="matrix" cellpadding="0" border=0 >
              <tr> <td> h<sub>11</sub> </td> <td> h<sub>12</sub> </td> <td class ="left_fence"> h<sub>13</sub> </td> </tr>
              <tr> <td> h<sub>21</sub> </td> <td> h<sub>22</sub> </td> <td class ="left_fence"> h<sub>22</sub> </td> </tr>
              <tr> <td colspan=3 style="padding:0px " > <hr style="margin:0px"> </td> </tr>
              <tr> <td> h<sub>23</sub> </td> <td> h<sub>32</sub> </td> <td  class ="left_fence"> h<sub>33</sub> </td> </tr>
            </table>
        </dd>
     </dl>


   </dd>

   <dt><h3>Problem</h3></dt>
   <dd>
     <dl>
         <dt>What we have</dt>
         <dd>

          <ul>
            <li>  s<sub>0</sub>, s<sub>x</sub>, s<sub>y</sub>, s<sub>z</sub> &isin; &reals;<sup>2</sup> </li>
            <li>  t<sub>0</sub>, t<sub>x</sub>, t<sub>y</sub>, t<sub>z</sub> &isin; &reals;<sup>2</sup> </li>
            <li> <i>o</i>=(0,0)</li>
            <li> det( s<sub>i</sub>, s<sub>j</sub>, s<sub>k</sub>  ) &ne; 0; i &ne; j &ne; k; i,j, k &isin; { 0, x, y, z }, this condition can be relaxed to only det( s<sub>0</sub>, s<sub>x</sub>, s<sub>y</sub>  ) &ne; 0; </li>
            <li> det( t<sub>i</sub>, t<sub>j</sub>, t<sub>k</sub>  ) &ne; 0; i &ne; j &ne; k; i,j, k &isin; { 0, x, y, z }</li>

            <li> Nice to have: <br>
              | det( t<sub>i</sub>, t<sub>j</sub>, t<sub>k</sub>  ) | &le; det( t<sub>0</sub>, t<sub>x</sub>, t<sub>y</sub>  )<br>
              | det( s<sub>i</sub>, s<sub>j</sub>, s<sub>k</sub>  ) | &le; det( s<sub>0</sub>, s<sub>x</sub>, s<sub>y</sub>  )<br>
              </li>
          </ul>

         </dd>
         <dt>What we want</dt>
         <dd>
           <ul>
            <li> <b>H</b> is homography matrix. </li>
            <li> t<sub>i</sub> = <b>H</b> ( s<sub>i</sub> ); i &isin; { 0, x, y, z }<br> </li>
           </ul>
         </dd>

     </dl>
   </dd>

   <dt><h3>Existing Solution</h3></dt>
   <dd>
     <dl>
         <dt>TODO</dt>
         <dd> TODO  </dd>
         <dt>TODO</dt>
         <dd> TODO  </dd>
         <dt>h<sub>33</sub> = 1 </dt>
         <dd>
           For simplicity in here
           x<sub>1</sub> = s<sub>0<sub>x</sub></sub>,
           y<sub>1</sub> = s<sub>0<sub>y</sub></sub>,
           ...,
           x'<sub>1</sub> = t<sub>0<sub>x</sub></sub>,
           y'<sub>1</sub> = t<sub>0<sub>y</sub></sub>,
           ...
          <br>
          And we have to solve :
         <table>
          <tr>
           <td>
             <table class="matrix" cellpadding="0" border=0 >
              <tr> <td> x<sub>1</sub> </td> <td> y<sub>1</sub> </td> <td> 1 </td> <td>             0 </td> <td>             0 </td><td> 0 </td> <td> -x<sub>1</sub> x'<sub>1</sub> </td> <td> -y<sub>1</sub> x'<sub>1</sub> </td>  </tr>
              <tr> <td>             0 </td> <td>             0 </td> <td> 0 </td> <td> x<sub>1</sub> </td> <td> y<sub>1</sub> </td><td> 1 </td> <td> -x<sub>1</sub> y'<sub>1</sub> </td> <td> -y<sub>1</sub> y'<sub>1</sub> </td>  </tr>
              <tr> <td> x<sub>2</sub> </td> <td> y<sub>2</sub> </td> <td> 1 </td> <td>             0 </td> <td>             0 </td><td> 0 </td> <td> -x<sub>2</sub> x'<sub>2</sub> </td> <td> -y<sub>2</sub> x'<sub>2</sub> </td>  </tr>
              <tr> <td>             0 </td> <td>             0 </td> <td> 0 </td> <td> x<sub>2</sub> </td> <td> y<sub>2</sub> </td><td> 1 </td> <td> -x<sub>2</sub> y'<sub>2</sub> </td> <td> -y<sub>2</sub> y'<sub>2</sub> </td>  </tr>
              <tr> <td> x<sub>3</sub> </td> <td> y<sub>3</sub> </td> <td> 1 </td> <td>             0 </td> <td>             0 </td><td> 0 </td> <td> -x<sub>3</sub> x'<sub>3</sub> </td> <td> -y<sub>3</sub> x'<sub>3</sub> </td>  </tr>
              <tr> <td>             0 </td> <td>             0 </td> <td> 0 </td> <td> x<sub>3</sub> </td> <td> y<sub>3</sub> </td><td> 1 </td> <td> -x<sub>3</sub> y'<sub>3</sub> </td> <td> -y<sub>3</sub> y'<sub>3</sub> </td>  </tr>
              <tr> <td> x<sub>4</sub> </td> <td> y<sub>4</sub> </td> <td> 1 </td> <td>             0 </td> <td>             0 </td><td> 0 </td> <td> -x<sub>4</sub> x'<sub>4</sub> </td> <td> -y<sub>4</sub> x'<sub>4</sub> </td>  </tr>
              <tr> <td>             0 </td> <td>             0 </td> <td> 0 </td> <td> x<sub>4</sub> </td> <td> y<sub>4</sub> </td><td> 1 </td> <td> -x<sub>4</sub> y'<sub>4</sub> </td> <td> -y<sub>4</sub> y'<sub>4</sub> </td>  </tr>
             </table>
           </td>
            <td>
              <table class="matrix" cellpadding="0" border=0 >
               <tr> <td> h<sub>11</sub> </td> </tr>
               <tr> <td> h<sub>12</sub> </td> </tr>
               <tr> <td> h<sub>13</sub> </td> </tr>
               <tr> <td> h<sub>21</sub> </td> </tr>
               <tr> <td> h<sub>22</sub> </td> </tr>
               <tr> <td> h<sub>23</sub> </td> </tr>
               <tr> <td> h<sub>31</sub> </td> </tr>
               <tr> <td> h<sub>32</sub> </td> </tr>
              </table>
           </td>
           <td>&nbsp; = &nbsp;</td>
           <td>
             <table class="matrix" cellpadding="0" border=0 >
              <tr> <td> x<sub>1</sub> </td> </tr>
              <tr> <td> y<sub>1</sub> </td> </tr>
              <tr> <td> x<sub>2</sub> </td> </tr>
              <tr> <td> y<sub>2</sub> </td> </tr>
              <tr> <td> x<sub>3</sub> </td> </tr>
              <tr> <td> y<sub>3</sub> </td> </tr>
              <tr> <td> y<sub>4</sub> </td> </tr>
              <tr> <td> x<sub>4</sub> </td> </tr>
             </table>
           </td>
           </tr>
          </table>
          Main disadvantaged here is that h<sub>33</sub> can be near zero and possibly produce numerical instabilities.
         </dd>
     </dl>
   </dd>

  <dt><h3>Bricks</h3></dt>
   <dd>
     ... or what we need to assemble  to get our matrix.
     <dl>
       <dt><h4>Translation</h4></dt>
       <dd>
        Move for some vector.<br> <br>
        (x+X,y+Y)=<b>P</b>(x,y)<br> <br>
        Homography matrix:
            <table class="matrix" cellpadding="0" border=0 >
              <tr> <td> 1</td> <td> 0 </td> <td class ="left_fence"> X  </td> </tr>
              <tr> <td> 0 </td> <td> 1 </td> <td class ="left_fence">Y  </td> </tr>
              <tr> <td colspan=3 style="padding:0px " > <hr style="margin:0px"> </td> </tr>
              <tr> <td> 0 </td> <td> 0</td> <td  class ="left_fence"> 1 </td> </tr>
            </table>
       </dd>

       <dt><h4>Linear</h4></dt>
       <dd>
          If <b>M</b> is linear function then: <br>
           <b>M</b>( &alpha; <b>x</b> + &beta; <b>y</b> ) = &alpha; <b>M</b>( <b>x</b> )  + &beta; * <b>M</b>( <b>y</b> ) <br> <br>
            Represented using homography matrix:
            <table class="matrix" cellpadding="0" border=0 >
              <tr> <td> a<sub>11</sub> </td> <td> a<sub>12</sub> </td> <td class ="left_fence"> 0 </td> </tr>
              <tr> <td> a<sub>12</sub> </td> <td> a<sub>22</sub> </td> <td class ="left_fence"> 0 </td> </tr>
              <tr> <td colspan=3 style="padding:0px " > <hr style="margin:0px"> </td> </tr>
              <tr> <td> 0 </td> <td> 0 </td> <td  class ="left_fence"> 1 </td> </tr>
            </table>
       </dd>

       <dt><h4>Affine</h4></dt>
       <dd>
            Represented using homography matrix:
            <table class="matrix" cellpadding="0" border=0 >
              <tr> <td> a<sub>11</sub> </td> <td> a<sub>12</sub> </td> <td class ="left_fence"> a<sub>13</sub> </td> </tr>
              <tr> <td> a<sub>21</sub> </td> <td> a<sub>22</sub> </td> <td class ="left_fence"> a<sub>23</sub> </td> </tr>
              <tr> <td colspan=3 style="padding:0px " > <hr style="margin:0px"> </td> </tr>
              <tr> <td> 0 </td> <td> 0 </td> <td  class ="left_fence"> 1 </td> </tr>
            </table>

            <table>
             <tr> <td> Where: &nbsp; </td>
               <td>
            <table class="matrix" >
              <tr>   <td> a<sub>11</sub> </td> <td> a<sub>12</sub> </td>  </tr>
              <tr>   <td> a<sub>21</sub> </td> <td> a<sub>22</sub> </td>  </tr>
            </table>
               </td>
               <td> &nbsp; is linear part. </td>
               </tr>
            </table>
            [ a<sub>13</sub>, a<sub>23</sub>]<sup>T</sup> is translation part.

       </dd>

       <dt><h4>Simple Homography</h4></dt>
       <dd>
        <div>
         <p>
         (0,0) = <b>P</b>(0,0);<br>
         (1,0) = <b>P</b>(1,0);<br>
         (0,1) = <b>P</b>(0,1);<br>
         (X,Y) = <b>P</b>(1,1);<br>
         </p>

         This can be represented by homography matrix:
          <table class="matrix">
              <tr>  <td> X </td> <td> 0 </td> <td class ="left_fence"> 0 </td>   </tr>
              <tr> <td> 0 </td> <td> Y </td> <td class ="left_fence"> 0 </td> </tr>
              <tr> <td colspan=3 style="padding:0px " > <hr style="margin:0px"> </td> </tr>
              <tr> <td> 1-Y </td> <td> 1-X </td> <td class ="left_fence"> X+Y-1 </td> </tr>
          </table>
          <table>
           <tr>  <td> 0 &ne; (1-Y)<sup>2</sup> + ( 1-X )<sup>2</sup> + ( X+Y-1 )<sup>2</sup> <br>
              Always &ne; 0. <br> Always exists.
           </td> <td> <img src="t21.png"/>  </td> </tr>
          </table>
        </div>
        <div>
        <br>... and vice versa
        <p>
         (0,0) = <b>P</b>(0,0);<br>
         (1,0) = <b>P</b>(1,0);<br>
         (0,1) = <b>P</b>(0,1);<br>
         (1,1) = <b>P</b>(X,Y);<br>
        </p>
         Homography matrix:
          <table class="matrix" >
              <tr> <td> Y * (X + Y - 1)</td> <td> 0 </td> <td  class ="left_fence"> 0 </td>  </tr>
              <tr> <td> 0 </td> <td> X * (X + Y - 1) </td> <td class ="left_fence"> 0 </td> </tr>
              <tr> <td colspan=3 style="padding:0px " > <hr style="margin:0px"> </td> </tr>
              <tr> <td> Y*(Y - 1) </td> <td> X*(X - 1) </td> <td class ="left_fence"> X*Y </td> </tr>
          </table>

          <table>
            <tr>  <td>  0 &ne; (Y*(Y - 1))<sup>2</sup> + (X*(X - 1))<sup>2</sup> + (X*Y)<sup>2</sup> <br>
             (X,Y) &ne; (0,0)<br>
             (X,Y) &ne; (0,1)<br>
             (X,Y) &ne; (0,0)<br>
            </td>
            <td> <img src="12s.png"/>   </td> </tr>
          </table>

        </div>
       </dd>
     </dl>
   </dd>

  <dt><h3>Building</h3></dt>
  <dd>
    <dl>

   <dt>
     <h4>Elements</h4>
   </dt>
   <dd>
    <ul>
      <li>

        <table width="100%">
          <tr>
           <td align="top" ><b>T<sub>s</sub></b>: translation matrix, translate from s<sub>0</sub> to <i>o=(0,0)</i></td>
           <td><img src="s-t.png" align="right"/></td>
          </tr>
        </table>

       </li>
      <li>
        <table width="100%">
          <tr>
           <td align="top">
              <b>M<sub>s</sub></b>:
              <blockquote>
             ( 1, 0 ) = <b>M<sub>s</sub></b>( <b>T<sub>s</sub></b> ( s<sub>x</sub> ) ) ,<br>
             ( 0, 1 ) = <b>M<sub>s</sub></b>( <b>T<sub>s</sub></b> ( s<sub>y</sub> ) )
              </blockquote>
           </td>
           <td><img src="s-m.png" align="right"/></td>
          </tr>
        </table>

       </li>
      <li>
        <table width="100%">
          <tr>
           <td align="top" >
             <b>P<sub>s</sub></b>:
               <blockquote>
               (0,0) = <b>P<sub>s</sub></b>( (0,0) ), <br>
               (1,0) = <b>P<sub>s</sub></b>( (1,0) ), <br>
               (0,1) = <b>P<sub>s</sub></b>( (0,1) ), <br>
               (1,1) = <b>P<sub>s</sub></b>(<b>M<sub>s</sub></b> <b>T<sub>s</sub></b>( s<sub>z</sub> ) )
               </blockquote>
           </td>
           <td><img src="s-p.png" align="right"/></td>
          </tr>
        </table>

        </li>
      <li>


        <table width="100%">
          <tr>
           <td align="top" >
            <b>T<sub>t</sub></b>: translation matrix, translate from t<sub>0</sub> to <i>o</i>
           </td>
           <td><img src="t-t.png" align="right"/></td>
          </tr>
        </table>


       </li>
      <li>
        <table width="100%">
          <tr>
           <td align="top" >
             <b>M<sub>t</sub></b>:
             <blockquote>
               ( 1, 0 ) = <b>M<sub>t</sub></b>( <b>T<sub>t</sub></b> ( t<sub>x</sub> ) ), <br>
               ( 0, 1 ) = <b>M<sub>t</sub></b>( <b>T<sub>t</sub></b> ( t<sub>y</sub> ) )
             </blockquote>
           </td>
           <td><img src="t-m.png" align="right"/></td>
          </tr>
        </table>
       </li>
      <li>
        <table width="100%">
          <tr>
           <td align="top" >
            <b>P<sub>t</sub></b>:
            <blockquote>
            (0,0) = <b>P<sub>t</sub></b>( (0,0) ),<br>
            (1,0) = <b>P<sub>t</sub></b>( (1,0) ),<br>
            (0,1) = <b>P<sub>t</sub></b>( (0,1) ), <br>
            (1,1) = <b>P<sub>t</sub></b>( <b>M<sub>t</sub></b> <b>T<sub>t</sub></b>( t<sub>z</sub> ) ) <br>
             &nbsp; &nbsp; &nbsp; <b>M<sub>t</sub></b> <b>T<sub>t</sub></b>( t<sub>z</sub> ) &notin;{ (0,0), (1,0), (0,1) }
            </blockquote>
           </td>
           <td><img src="t-p.png" align="right"/></td>
          </tr>
        </table>
       </li>
    </ul>
   </dd>

   <dt>
     <h4>Assembling</h4>
   </dt>
   <dd>
    <b>H</b>
     = (<b>P<sub>t</sub></b>    <b>M<sub>t</sub></b> <b>T<sub>t</sub></b>   )<sup>-1</sup>   <b>P<sub>s</sub></b>  <b>M<sub>s</sub></b>   <b>T<sub>s</sub></b>
     = <b>T<sub>t</sub><sup>-1</sup></b>   <b>M<sub>t</sub><sup>-1</sup></b>   <b>P<sub>t</sub><sup>-1</sup></b>   <b>P<sub>s</sub></b>  <b>M<sub>s</sub></b>   <b>T<sub>s</sub></b>
   </dd>

   </dl>

  </dd>

    <dt>
     Miscellaneous
   </dt>
   <dd>
    <dl>

      <dt><h4>Source code</h4><dt>
      <dd>
       github.com/dmilos/math/linar/homography/construct2.hpp<br>
      </dd>

      <dt><h4>Comment</h4><dt>
      <dd>
       <ul>
        <li> This can be easily extend to higher dimensions</li>
        <li> With appropriate effort it can be make in close forme.</li>
       <ul>
      </dd>
    <dl>

    </dd>

 </dl>


 </body>
</html>

